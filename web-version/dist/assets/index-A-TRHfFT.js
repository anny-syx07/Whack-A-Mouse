(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&t(u)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function t(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();class o{constructor(s){this.canvas=s,this.ctx=s.getContext("2d"),this.images=new Map,this.sounds=new Map,this.music=new Map,this.currentMusic=null,this.musicVolume=.5,this.sfxVolume=.5}async loadTexture(s){return this.images.has(s)?this.images.get(s):new Promise((e,t)=>{const i=new Image;i.onload=()=>{this.images.set(s,i),e(i)},i.onerror=t,i.src=s})}async loadMusic(s){if(this.music.has(s))return this.music.get(s);const e=new Audio(s);return e.loop=!0,e.volume=this.musicVolume,this.music.set(s,e),e}async loadSound(s){if(this.sounds.has(s))return this.sounds.get(s);const e=new Audio(s);return e.volume=this.sfxVolume,this.sounds.set(s,e),e}renderTexture(s,e,t,i=null,a=null){if(!s)return;const u=i||s.width,c=a||s.height;this.ctx.drawImage(s,e,t,u,c)}renderText(s,e,t,i="20px Arial",a="#fff"){this.ctx.font=i,this.ctx.fillStyle=a,this.ctx.fillText(s,e,t)}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}playMusic(s){this.currentMusic&&(this.currentMusic.pause(),this.currentMusic.currentTime=0),this.currentMusic=s,s.play().catch(e=>console.log("Music play failed:",e))}playSound(s){s&&(s.currentTime=0,s.play().catch(e=>console.log("Sound play failed:",e)))}setMusicVolume(s){this.musicVolume=s,this.currentMusic&&(this.currentMusic.volume=s)}setSfxVolume(s){this.sfxVolume=s,this.sounds.forEach(e=>{e.volume=s})}}class d{constructor(s,e,t,i,a,u,c){this.col=s,this.y=e,this.speed=t,this.texSong=i,this.texChet=a,this.song=u,this.visible=c}}class h{constructor(s,e,t,i){this.x1=s,this.x2=e,this.y1=t,this.y2=i}isInside(s,e){return s>=this.x1&&s<=this.x2&&e>=this.y1&&e<=this.y2}}class l{constructor(){this.score=0,this.lives=3,this.mxscore=0,this.loadHighScore()}saveHighScore(){localStorage.setItem("whack-a-mouse-highscore",this.mxscore.toString())}loadHighScore(){const s=localStorage.getItem("whack-a-mouse-highscore");this.mxscore=s?parseInt(s):0}updateHighScore(){this.score>this.mxscore&&(this.mxscore=this.score,this.saveHighScore())}resetGame(){this.score=0,this.lives=3}}const r={StartScreen:"StartScreen",Playing:"Playing",GameOver:"GameOver",InfoScreen:"InfoScreen",Pause:"Pause",Settings:"Settings"};class p{constructor(s){this.graphics=new o(s),this.stat=new l,this.curState=r.StartScreen,this.soundEnabled=!0,this.newGame=!0,this.clicked=!1,this.spawnInterval=2e3,this.idx=1,this.isRunning=!0,this.lastSpawnTime=0,this.musicX=80,this.sfxX=80,this.xBasechuot=[110,170,250,320],this.xBasemeo=[80,150,220,300],this.cot=[new h(100,170,350,800),new h(175,240,350,800),new h(241,313,350,800),new h(314,390,350,800)],this.nutBatDau=new h(100,400,550,638),this.nutInfo=new h(10,60,20,70),this.tatInfo=new h(360,400,200,250),this.nutPlayAgain=new h(100,400,550,638),this.nutPause=new h(400,450,10,60),this.nutResume=new h(150,300,480,540),this.nutHome=new h(150,300,570,630),this.vlbar=new h(90,362,280,300),this.sfxbar=new h(90,362,390,410),this.nutSet=new h(400,450,10,55),this.m1=new h(150,170,500,520),this.m2=new h(250,270,500,520),this.m3=new h(380,400,500,520),this.mouse=[],this.textures={},this.sounds={},this.music={},this.dragvol=!1,this.dragsfx=!1,this.muzik=!1}async init(){this.textures.background=await this.graphics.loadTexture("assets/picture/background.jpg"),this.textures.play=await this.graphics.loadTexture("assets/picture/play.png"),this.textures.playagain=await this.graphics.loadTexture("assets/picture/playagain.png"),this.textures.board=await this.graphics.loadTexture("assets/picture/board.png"),this.textures.meodungyen=await this.graphics.loadTexture("assets/picture/meodungyen.png"),this.textures.meodap=await this.graphics.loadTexture("assets/picture/meodap.png"),this.textures.info=await this.graphics.loadTexture("assets/picture/info.png"),this.textures.diemmeo=await this.graphics.loadTexture("assets/picture/diemmeo.png"),this.textures.diemchuot=await this.graphics.loadTexture("assets/picture/diemchuot.png"),this.textures.huongdan=await this.graphics.loadTexture("assets/picture/huongdan.png"),this.textures.pause=await this.graphics.loadTexture("assets/picture/pause.png"),this.textures.menupause=await this.graphics.loadTexture("assets/picture/manhinhpause.png"),this.textures.volumebar=await this.graphics.loadTexture("assets/picture/volumebar.png"),this.textures.cursor=await this.graphics.loadTexture("assets/picture/cursor.png"),this.textures.settings=await this.graphics.loadTexture("assets/picture/settings.png"),this.textures.menuset=await this.graphics.loadTexture("assets/picture/manhinhset.png"),this.textures.tick=await this.graphics.loadTexture("assets/picture/tick.png"),this.textures.anhsong=[],this.textures.anhchet=[];const s=["xamsong","nausong","camsong","xanh"],e=["xamchet","nauchet","camchet","xanh"];for(let t=0;t<4;t++)this.textures.anhsong[t]=await this.graphics.loadTexture(`assets/picture/${s[t]}.png`),this.textures.anhchet[t]=await this.graphics.loadTexture(`assets/picture/${e[t]}.png`);this.music.retro=await this.graphics.loadMusic("assets/sound/retroarcadesound.mp3"),this.music.mario=await this.graphics.loadMusic("assets/sound/mario.mp3"),this.music.bitgame=await this.graphics.loadMusic("assets/sound/bitgame.mp3"),this.currentMusic=this.music.retro,this.sounds.hup=await this.graphics.loadSound("assets/sound/hup-sound.mpga"),this.sounds.meow=await this.graphics.loadSound("assets/sound/meow.mp3"),this.sounds.pop=await this.graphics.loadSound("assets/sound/pop.mp3"),this.graphics.playMusic(this.currentMusic)}handleEvents(s){switch(s.type){case"click":this.handleClick(s.offsetX,s.offsetY);break;case"keydown":s.key==="Escape"&&this.curState===r.Playing&&(this.curState=r.Pause);break;case"mousedown":this.handleMouseDown(s.offsetX,s.offsetY);break;case"mouseup":this.handleMouseUp(s.offsetX,s.offsetY);break;case"mousemove":this.handleMouseMove(s.offsetX,s.offsetY);break}}handleClick(s,e){switch(this.curState){case r.StartScreen:this.nutBatDau.isInside(s,e)&&(this.curState=r.Playing,this.resetGame()),this.nutInfo.isInside(s,e)&&(this.curState=r.InfoScreen),this.nutSet.isInside(s,e)&&(this.curState=r.Settings);break;case r.Playing:this.handleGameClick(s,e),this.nutPause.isInside(s,e)&&(this.curState=r.Pause);break;case r.GameOver:this.nutPlayAgain.isInside(s,e)&&(this.curState=r.Playing,this.resetGame());break;case r.InfoScreen:this.tatInfo.isInside(s,e)&&(this.curState=r.StartScreen);break;case r.Pause:this.nutResume.isInside(s,e)&&(this.curState=r.Playing),this.nutHome.isInside(s,e)&&(this.curState=r.StartScreen);break;case r.Settings:this.handleSettingsClick(s,e);break}}handleGameClick(s,e){for(let t=0;t<this.mouse.length;t++)if(this.cot[this.mouse[t].col].isInside(s,e)&&this.mouse[t].visible&&this.mouse[t].song){this.mouse[t].song=!1,this.mouse[t].texSong=this.textures.anhchet[this.mouse[t].col],this.mouse[t].col===3?this.stat.lives=0:(this.stat.score+=this.mouse[t].col+1,this.graphics.playSound(this.sounds.pop));break}}handleSettingsClick(s,e){this.m1.isInside(s,e)&&(this.currentMusic=this.music.retro,this.graphics.playMusic(this.currentMusic)),this.m2.isInside(s,e)&&(this.currentMusic=this.music.mario,this.graphics.playMusic(this.currentMusic)),this.m3.isInside(s,e)&&(this.currentMusic=this.music.bitgame,this.graphics.playMusic(this.currentMusic)),this.nutHome.isInside(s,e)&&(this.curState=r.StartScreen)}handleMouseDown(s,e){this.curState===r.Settings&&(this.vlbar.isInside(s,e)&&(this.dragvol=!0),this.sfxbar.isInside(s,e)&&(this.dragsfx=!0))}handleMouseUp(s,e){this.dragvol=!1,this.dragsfx=!1,this.muzik=!1}handleMouseMove(s,e){if(this.dragvol&&this.curState===r.Settings){const t=Math.max(0,Math.min(272,s-90));this.musicX=t,this.graphics.setMusicVolume(t/272)}if(this.dragsfx&&this.curState===r.Settings){const t=Math.max(0,Math.min(272,s-90));this.sfxX=t,this.graphics.setSfxVolume(t/272)}}update(){const s=Date.now();if(this.curState===r.Playing){s-this.lastSpawnTime>this.spawnInterval&&(this.spawnMouseIfNeeded(),this.lastSpawnTime=s,this.spawnInterval>800&&(this.spawnInterval-=50));for(let e=this.mouse.length-1;e>=0;e--){const t=this.mouse[e];t.y+=t.speed,t.y>800&&(t.song&&t.col!==3&&(this.stat.lives--,this.graphics.playSound(this.sounds.meow)),this.mouse.splice(e,1))}this.stat.lives<=0&&(this.curState=r.GameOver,this.stat.updateHighScore())}}spawnMouseIfNeeded(){const s=Math.floor(Math.random()*4),e=Math.floor(Math.random()*100);let t,i;e<50?(t=0,i=2):e<80?(t=1,i=3):e<95?(t=2,i=4):(t=3,i=4);const a=new d(s,350,i,this.textures.anhsong[t],this.textures.anhchet[t],!0,!0);this.mouse.push(a)}render(){switch(this.graphics.clear(),this.curState){case r.StartScreen:this.renderStartScreen();break;case r.Playing:this.renderGameScreen();break;case r.GameOver:this.renderGameOverScreen();break;case r.InfoScreen:this.renderInfoScreen();break;case r.Pause:this.renderPauseScreen();break;case r.Settings:this.renderSettingsScreen();break}}renderStartScreen(){this.graphics.renderTexture(this.textures.background,0,0),this.graphics.renderTexture(this.textures.play,100,550),this.graphics.renderTexture(this.textures.info,10,20),this.graphics.renderTexture(this.textures.settings,400,10),this.graphics.renderText("WHACK-A-MOUSE",150,100,"40px Arial","#fff"),this.graphics.renderText(`High Score: ${this.stat.mxscore}`,150,150,"20px Arial","#fff")}renderGameScreen(){this.graphics.renderTexture(this.textures.background,0,0),this.graphics.renderTexture(this.textures.board,60,350),this.graphics.renderTexture(this.textures.pause,400,10);for(const s of this.mouse)if(s.visible){const e=s.song?s.texSong:s.texChet,t=this.xBasechuot[s.col];this.graphics.renderTexture(e,t,s.y,50,50)}this.graphics.renderText(`Score: ${this.stat.score}`,20,30,"20px Arial","#fff"),this.graphics.renderText(`Lives: ${this.stat.lives}`,20,60,"20px Arial","#fff")}renderGameOverScreen(){this.graphics.renderTexture(this.textures.background,0,0),this.graphics.renderText("GAME OVER",150,200,"40px Arial","#fff"),this.graphics.renderText(`Final Score: ${this.stat.score}`,150,250,"24px Arial","#fff"),this.graphics.renderText(`High Score: ${this.stat.mxscore}`,150,280,"24px Arial","#fff"),this.graphics.renderTexture(this.textures.playagain,100,550)}renderInfoScreen(){this.graphics.renderTexture(this.textures.huongdan,0,0),this.graphics.renderTexture(this.textures.diemchuot,360,200),this.graphics.renderTexture(this.textures.diemmeo,360,200)}renderPauseScreen(){this.graphics.renderTexture(this.textures.menupause,0,0)}renderSettingsScreen(){this.graphics.renderTexture(this.textures.menuset,0,0),this.graphics.renderTexture(this.textures.volumebar,90,280),this.graphics.renderTexture(this.textures.volumebar,90,390);const s=Math.min(342,Math.max(90,90+this.musicX-10)),e=Math.min(342,Math.max(90,90+this.sfxX-10));this.graphics.renderTexture(this.textures.cursor,s,280),this.graphics.renderTexture(this.textures.cursor,e,390),this.graphics.renderTexture(this.textures.tick,150,500)}resetGame(){this.stat.resetGame(),this.mouse=[],this.spawnInterval=2e3,this.lastSpawnTime=Date.now()}run(){const s=()=>{this.isRunning&&(this.update(),this.render(),requestAnimationFrame(s))};requestAnimationFrame(s),this.graphics.canvas.addEventListener("click",e=>this.handleEvents({type:"click",offsetX:e.offsetX,offsetY:e.offsetY})),this.graphics.canvas.addEventListener("mousedown",e=>this.handleEvents({type:"mousedown",offsetX:e.offsetX,offsetY:e.offsetY})),this.graphics.canvas.addEventListener("mouseup",e=>this.handleEvents({type:"mouseup",offsetX:e.offsetX,offsetY:e.offsetY})),this.graphics.canvas.addEventListener("mousemove",e=>this.handleEvents({type:"mousemove",offsetX:e.offsetX,offsetY:e.offsetY})),document.addEventListener("keydown",e=>this.handleEvents({type:"keydown",key:e.key}))}}async function m(){const n=document.getElementById("gameCanvas"),s=new p(n);try{await s.init(),s.run(),console.log("Whack-A-Mouse game started!")}catch(e){console.error("Failed to start game:",e)}}window.addEventListener("load",m);
